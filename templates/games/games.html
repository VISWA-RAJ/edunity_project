{% extends 'base.html' %}
{% block title %}Mini Games - Edunity{% endblock %}

{% block content %}
  <section class="hero">
    <h1>ğŸ® Mini Games</h1>
    <p>Take a break, play, and have fun with friends!</p>
  </section>
  
  <section class="leaderboard mini-leaderboard">
    <h2>ğŸ† Top Players (Total Score)</h2>
    <table>
      <thead>
        <tr><th>Rank</th><th>Player</th><th>Total Game Score</th></tr>
      </thead>
      <tbody>
        {% for player_data in leaderboard %}
          <tr {% if player_data.user == request.user %}class="current-user-row"{% endif %}>
            <td>
              {% if forloop.counter == 1 %}ğŸ¥‡{% elif forloop.counter == 2 %}ğŸ¥ˆ{% elif forloop.counter == 3 %}ğŸ¥‰{% else %}{{ forloop.counter }}{% endif %}
            </td>
            <td>{{ player_data.user.username }}</td>
            <td>{{ player_data.total_score }}</td>
          </tr>
        {% endfor %}
        {% if my_rank > 4 %}
          <tr class="separator-row"><td colspan="3">...</td></tr>
          <tr class="current-user-row">
            <td>{{ my_rank }}</td>
            <td>{{ request.user.username }} (You)</td>
            <td>{{ my_total_score }}</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </section>

  <section class="games-grid">
    <div class="game-card">
      <h3>ğŸ Snake Game</h3>
      <p>How long can your snake survive?</p>
      <a href="{% url 'snake_game' %}">Play Now</a>
    </div>
    <div class="game-card">
      <h3>ğŸ¦ Flappy Bird</h3>
      <p>Navigate the pipes in this classic challenge.</p>
      <a href="{% url 'flappy_bird' %}">Play Now</a>
    </div>
    <div class="game-card">
      <h3>ğŸ¦– Dino Run</h3>
      <p>Jump and duck to avoid the obstacles.</p>
      <a href="{% url 'dino_game' %}">Play Now</a>
    </div>

    <div class="game-card">
      <h3>ğŸ’° Coin Collector</h3>
      <p>Catch coins and dodge the bombs!</p>
      <a href="{% url 'coin_collector' %}">Play Now</a>
    </div>

{# --- MODIFIED LOCKED GAME CARD --- #}
{# The entire div is now inside the if statement. #}
{# It will only appear if the user has purchased the item. #}
{% if "flappy-roast-politics-version" in user_inventory_ids %}
  <div class="game-card">
    <h3>ğŸ‘¾ Flappy Roast (Politics Version)</h3>
    <p>An exclusive game, available in the shop!</p>
    <a href="{% url 'flappy_roast_politics' %}">Play Now</a>
  </div>
{% endif %}
{# --- END OF MODIFIED BLOCK --- #}

  </section>
{% endblock %}

